!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).SRT=i()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=function(i,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])})(i,s)};function i(i,s){function e(){this.constructor=i}t(i,s),i.prototype=null===s?Object.create(s):(e.prototype=s.prototype,new e)}var s=function(){return(s=Object.assign||function(t){for(var i,s=1,e=arguments.length;s<e;s++)for(var n in i=arguments[s])Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);return t}).apply(this,arguments)};function e(t,i,s,e){var n,r=arguments.length,h=r<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,i,s,e);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(h=(r<3?n(h):r>3?n(i,s,h):n(i,s))||h);return r>3&&h&&Object.defineProperty(i,s,h),h}function n(){for(var t=0,i=0,s=arguments.length;i<s;i++)t+=arguments[i].length;var e=Array(t),n=0;for(i=0;i<s;i++)for(var r=arguments[i],h=0,o=r.length;h<o;h++,n++)e[n]=r[h];return e}try{Object.entries||(Object.entries=function(t){for(var i=Object.keys(t),s=i.length,e=new Array(s);s--;)e[s]=[i[s],t[i[s]]];return e}),Array.prototype.includes||(Array.prototype.includes=function(t){return!!~this.indexOf(t)})}catch(t){console.error("polyfill exec failed",t)}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,o=function(t){return function(t){for(var i,s,e,n,h="",o=0,a=(t=String(t)).length%3;o<t.length;){if((s=t.charCodeAt(o++))>255||(e=t.charCodeAt(o++))>255||(n=t.charCodeAt(o++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");h+=r.charAt((i=s<<16|e<<8|n)>>18&63)+r.charAt(i>>12&63)+r.charAt(i>>6&63)+r.charAt(63&i)}return a?h.slice(0,a-3)+"===".substring(a):h}(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,i){var s;return s="0x"+i,String.fromCharCode(s)})))},a=function(t){return decodeURIComponent(function(t){if(t=String(t).replace(/[\t\n\f\r ]+/g,""),!h.test(t))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");t+="==".slice(2-(3&t.length));for(var i,s,e,n="",o=0;o<t.length;)i=r.indexOf(t.charAt(o++))<<18|r.indexOf(t.charAt(o++))<<12|(s=r.indexOf(t.charAt(o++)))<<6|(e=r.indexOf(t.charAt(o++))),n+=64===s?String.fromCharCode(i>>16&255):64===e?String.fromCharCode(i>>16&255,i>>8&255):String.fromCharCode(i>>16&255,i>>8&255,255&i);return n}(t).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))},c={encode:function(t){return o(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},decode:function(t){var i=(t=t.replace(/\-/g,"+").replace(/_/g,"/")).length%4;return i>0&&(t+="====".substring(i)),a(t)}},u=Object.prototype.toString,d=c,p=function(t){return"[object Object]"===u.call(t)},f=function(t){return"[object Array]"===u.call(t)},l=function(t,i){var s;void 0===i&&(i=0);var e=[];return function(){for(var n=arguments,r=[],h=0;h<arguments.length;h++)r[h]=n[h];return clearTimeout(s),s=setTimeout((function(){var i=t.apply(void 0,r);e.forEach((function(t){return t(i)})),e=[]}),i),new Promise((function(t){return e.push(t)}))}},g=function(){return Date.now()+"-"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)}))},v=function(){for(var t=arguments,i=[],s=0;s<arguments.length;s++)i[s]=t[s];return 0===i.length?{}:i.length<2?i[0]:i.reduce((function(t,i){if(!p(t)||!p(i))return console.error("deepMerge arguments only access object"),t;var s=t||{};return Object.entries(i).forEach((function(i){var e=i[0],r=i[1];if(void 0!==r)if(t[e])if(f(t[e])){if(!f(r))return void(s[e]=r);var h=f(r)?r:[r];s[e]=n(t[e],h)}else p(t[e])?s[e]=v(t[e],r):s[e]=r;else s[e]=r})),s}))},x=function(t){return!!/^[a-zA-Z\$_][a-zA-Z\d_]*$/.test(t)},_=function(t){function e(i){var s=t.call(this,i.request)||this;return s.stack=[],s.initialize=function(){return Promise.resolve(!0)},s.add=function(t){s.stack.push(t)},s.getItems=function(){return s.stack},s.unshift=function(t){var i;return(i=s.stack).unshift.apply(i,t)},s.clean=function(){var t=s.stack;return s.stack=[],t},s.option=i,s.initialize(),s}return i(e,t),e.prototype.flush=function(t){var i=this;if(void 0===t&&(t={}),this.stack.length){var e=this.stack.map((function(i){return i.props=s(s({},i.props),t),i}));this.stack=[],this.upload({events:e}).then((function(t){t.success||(i.stack=e)})).catch((function(){i.stack=e}))}},e}((function(t){this.delay=100,this.upload=l(t,this.delay)})),S=function(t,i,s){var e=s.value;return s.value=function(){var t;try{t=e.apply(this,arguments)}catch(t){try{console.error("Calling "+i+" error with",arguments),console.error(t);var s=this.getServerUrl();this.request({type:"sdk api exec error",props:{sr_sdk_version:this.version,system_info:this.getSystemInfo(),message:(t||{}).message||t,stack:(t||{}).stack}},{url:s,method:"POST"})}catch(t){}}return t},s},y=function(t,i,s){var e=s.value;return s.value=function(){if(this.inited)return e.apply(this,arguments);console.error("\u8bf7\u5148\u5b8c\u6210\u521d\u59cb\u5316")},s},m={SDK:"__SR_SDK_TRACKER__",TRACKS:"TRACKS",USER_INFO:"USER_INFO"},k={WAITING:"WAITING",REPORTING:"REPORTING",PAUSED:"PAUSED"},b={MISS:"should exec cacheManagerInitialize first"},I={};try{I=JSON.parse('{"mp":{"version":{"min":"1.1.8","max":"1.2.9"},"download":"https://sr-home-1257214331.cos.ap-guangzhou.myqcloud.com/sdk/sdk-weapp/index.js"},"xxx-for-git":{}}')}catch(t){}var A=function(){function t(){var t=this;this.versions=I,this.env="production",this.cachePrefix=m.SDK,this.inited=!1,this.option={},this.context={},this.reportState=k.WAITING,this.triggerFlush=l((function(){t.checkAndUpload()}),1e3),this.eventDataFmatter=function(i){var e=+new Date,n=t.getPageInfo();if(void 0!==t._onQueue){var r=t._onQueue(i);p(i)?i=r:console.warn("eventDataFmatter should return Object type")}return s(s(s({},n),i),{time:e})},this.checkRequiredOptionItem=function(){return!!t.option.token||(t.option.skipTokenCheck?(console.warn("token \u672a\u914d\u7f6e\uff0c\u5df2\u8df3\u8fc7\u8be5\u68c0\u67e5"),!0):(console.error("sdk.init - Option \u5fc5\u8981\u53c2\u6570\u914d\u7f6e\u7f3a\u5931\uff0c\u8bf7\u68c0\u67e5"),!1))},this.checkVersionInfo=function(){t.setContext({sr_sdk_version:t.version});var i="https://sr-home-1257214331.cos.ap-guangzhou.myqcloud.com/sdk/sr-sdk-version-info.json?timesamp="+Date.now();return t.request({},{url:i,method:"GET"}).then((function(i){var s=(i.data||{})[t.name],e=!0;if(s){var n=(((t.versions||{})[t.name]||{}).version||{}).max;return n&&(s.version.min>n?(console.error("\u5f53\u524dSDK\u7248\u672c\u8fc7\u4f4e, \u8bf7\u5347\u7ea7\uff01"),e=!1):s.version.max>n&&console.warn("\u5f53\u524dSDK\u6709\u66f4\u65b0, \u63a8\u8350\u5347\u7ea7\uff01")),{success:e,data:s,msg:""}}})).catch((function(t){return void 0===t&&(t={}),{success:!1,data:void 0,msg:t.errMsg}}))},this.queueInitialize=function(){var i=t.getServerUrl();return t.queue=new _({request:function(e){var n=e.events.map((function(i){return s(s({},i),{from:"sr-sdk-wxapp",tracking_id:t.tracking_id})}));return t.request(n,{url:i,method:"POST"}).catch((function(t){return console.error("APICaller error",t),t}))}}),!0},this.tracking_id=g(),this.checkStaticMethods()}return t.prototype.init=function(t){if(this.inited)return this;if(this.version=((this.versions[this.name]||{}).version||{}).max,this.option=v(this.defaultOptions,this.option,t),!this.checkRequiredOptionItem())return this;this.cacheManagerInitialize();try{this.proxyInitialize()}catch(t){this.errorHandle(t)}return this.queueInitialize(),this.contextInitialize(),this.inited=!0,this.checkFallback(),this.option.autoStart&&this.startReport(),this.checkVersionInfo(),this},t.prototype.track=function(t,i){var s=this.option.debug;JSON.stringify(i||{}).length>5e3&&console.warn("\u76d1\u6d4b\u5230\u8d85\u8fc75000\u7684\u4e0a\u62a5\u65e5\u5fd7\uff1a"+t);var e=this.eventDataFmatter(i);return s&&console&&"function"==typeof console.log&&console.log("\u3010Track\u3011 "+t,e),this.queue.add({type:t,props:e}),this.triggerFlush(),this},t.prototype.setContext=function(t){return console.warn("setContext \u4e0d\u5728\u63a8\u8350\u4f7f\u7528\uff0c\u8bf7\u7528\u66f4\u8f7b\u4fbf\u7684 setUser\u3001setChan\u7b49\u65b9\u6cd5\u4ee3\u66ff"),this.context=s(s(s({},this.context),t),{wx_user:s(s({},this.context.wx_user),t.wx_user||{}),chan:s(s({},this.context.chan),t.chan||{})}),this},t.prototype.setUser=function(t){return void 0===t&&(t={}),this.context=Object.assign({},this.context,{wx_user:s(s({},this.context.wx_user),t)}),this.setCache(m.USER_INFO,this.context.wx_user),this},t.prototype.setChan=function(t){var i=t.chan_id,e=(this.context.chan||{}).chan_id;return this.context=Object.assign({},this.context,{chan:s(s(s({},this.context.chan),t),{chan_id:i||(e||"")})}),this},t.prototype.setComponent=function(t){var i=t.component_id,e=t.component_name;return this.context=Object.assign({},this.context,{component:s(s({},t),{component_id:i,component_name:e})}),this},t.prototype.clearComponent=function(){return delete this.context.component,this},t.prototype.setActivityInfo=function(t){var i=t.activity_id,e=t.activity_name,n=t.activity_type,r=t.activity_index;return this.context=Object.assign({},this.context,{activity_info:s(s({},t),{activity_id:i,activity_name:e,activity_type:n,activity_index:r})}),this},t.prototype.clearActivityInfo=function(){return delete this.context.activity_info,this},t.prototype.startReport=function(){return this.reportState=k.REPORTING,this.triggerFlush(),this},t.prototype.resumeReport=function(){var t=this.getCache(m.TRACKS)||[];return this.queue.unshift(t),this.reportState===k.PAUSED&&(this.reportState=k.REPORTING),this.triggerFlush(),this},t.prototype.pauseReport=function(){return this.reportState=k.PAUSED,this.setCache(m.TRACKS,this.queue.clean()),this},t.prototype.flush=function(){return this.queue.flush(this.context),this},t.prototype.onQueue=function(t){return this._onQueue=t,this},t.prototype.getInfo=function(){var t={option:this.option,tracking_id:this.tracking_id,context:this.context,is_dev:this.isDev()};return"SR_SDK_INFO="+d.encode(JSON.stringify(t))},t.prototype.checkStaticMethods=function(){if("development"===this.env)try{var t=this.constructor;["create"].forEach((function(i){!t[i]&&console.error("static "+i+" should be implement")}))}catch(t){console.error("checkStaticMethods error",t)}},t.prototype.checkFallback=function(){var t=this;setTimeout((function(){t.checkAndUpload(),t.checkFallback()}),1e4)},t.prototype.checkAndUpload=function(){this.reportState===k.REPORTING&&this.flush()},t.prototype.contextInitialize=function(){var t=this.getUser(),i=this.getSystemInfo(),e=i.brand,n=i.model,r=i.version,h=i.environment,o=i.screenWidth,a=i.screenHeight,c=i.system,u=i.platform;this.context=v(this.context,{wx_user:s({app_id:this.option.appid},t),system_info:{brand:e,model:n,version:r,environment:h,screenWidth:o,screenHeight:a,system:c,platform:u},chan:{}})},t.prototype.getUser=function(){var t=this.context.wx_user||this.getCache(m.USER_INFO)||{};return t.local_id&&50===t.local_id.length||(t={local_id:g()},this.setCache(m.USER_INFO,t)),t},t.prototype.cacheManagerInitialize=function(){var t=this.getCacheManager();this.cacheManager=t},t.prototype.getCache=function(t){return this.cacheManager?(this.cacheManager.get(m.SDK)||{})[t]:(console.error(b.MISS),{})},t.prototype.setCache=function(t,i){var e;this.cacheManager||console.error(b.MISS);var n=s(s({},this.cacheManager.get(m.SDK)||{}),((e={})[t]=i,e));this.cacheManager.set(m.SDK,n)},t.prototype.getServerUrl=function(){var t="";return t="function"==typeof this.option.serverUrl?this.option.serverUrl.call(this):this.option.serverUrl||"https://zhls.qq.com/api/report",t+="?token="+this.option.token},e([S],t.prototype,"init",null),e([S,y],t.prototype,"track",null),e([S,y],t.prototype,"setContext",null),e([S,y],t.prototype,"setUser",null),e([S,y],t.prototype,"setChan",null),e([S,y],t.prototype,"setComponent",null),e([S,y],t.prototype,"clearComponent",null),e([S,y],t.prototype,"setActivityInfo",null),e([S,y],t.prototype,"clearActivityInfo",null),e([S,y],t.prototype,"startReport",null),e([S,y],t.prototype,"resumeReport",null),e([S,y],t.prototype,"pauseReport",null),e([S,y],t.prototype,"flush",null),e([S,y],t.prototype,"onQueue",null),e([S,y],t.prototype,"getInfo",null),t}();function w(t,i,s,e){void 0===e&&(e=!1);var r=t[i];t[i]=function(){for(var t=arguments,i=this,h=[],o=0;o<arguments.length;o++)h[o]=t[o];var a=function(){return r&&r.apply(i,h)};return e&&(a=function(){return Promise.resolve().then((function(){return r.apply(i,h)}))}),s.apply(this,n([a],h))}}var C=function(){function t(){}return t.AddUnsigned=function(t,i){var s,e,n,r,h;return n=2147483648&t,r=2147483648&i,h=(1073741823&t)+(1073741823&i),(s=1073741824&t)&(e=1073741824&i)?2147483648^h^n^r:s|e?1073741824&h?3221225472^h^n^r:1073741824^h^n^r:h^n^r},t.FF=function(t,i,s,e,n,r,h){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.F(i,s,e),n),h)),this.AddUnsigned(this.RotateLeft(t,r),i)},t.GG=function(t,i,s,e,n,r,h){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.G(i,s,e),n),h)),this.AddUnsigned(this.RotateLeft(t,r),i)},t.HH=function(t,i,s,e,n,r,h){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.H(i,s,e),n),h)),this.AddUnsigned(this.RotateLeft(t,r),i)},t.II=function(t,i,s,e,n,r,h){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.I(i,s,e),n),h)),this.AddUnsigned(this.RotateLeft(t,r),i)},t.ConvertToWordArray=function(t){for(var i,s=t.length,e=s+8,n=16*((e-e%64)/64+1),r=Array(n-1),h=0,o=0;o<s;)h=o%4*8,r[i=(o-o%4)/4]=r[i]|t.charCodeAt(o)<<h,o++;return h=o%4*8,r[i=(o-o%4)/4]=r[i]|128<<h,r[n-2]=s<<3,r[n-1]=s>>>29,r},t.WordToHex=function(t){var i,s="",e="";for(i=0;i<=3;i++)s+=(e="0"+(t>>>8*i&255).toString(16)).substr(e.length-2,2);return s},t.Utf8Encode=function(t){var i,s="";t=t.replace(/\r\n/g,"\n");for(var e=0;e<t.length;e++)(i=t.charCodeAt(e))<128?s+=String.fromCharCode(i):i>127&&i<2048?(s+=String.fromCharCode(i>>6|192),s+=String.fromCharCode(63&i|128)):(s+=String.fromCharCode(i>>12|224),s+=String.fromCharCode(i>>6&63|128),s+=String.fromCharCode(63&i|128));return s},t.init=function(t){for("string"!=typeof t&&(t=JSON.stringify(t)),this._string=this.Utf8Encode(t),this.x=this.ConvertToWordArray(this._string),this.a=1732584193,this.b=4023233417,this.c=2562383102,this.d=271733878,this.k=0;this.k<this.x.length;this.k+=16)this.AA=this.a,this.BB=this.b,this.CC=this.c,this.DD=this.d,this.a=this.FF(this.a,this.b,this.c,this.d,this.x[this.k],this.S11,3614090360),this.d=this.FF(this.d,this.a,this.b,this.c,this.x[this.k+1],this.S12,3905402710),this.c=this.FF(this.c,this.d,this.a,this.b,this.x[this.k+2],this.S13,606105819),this.b=this.FF(this.b,this.c,this.d,this.a,this.x[this.k+3],this.S14,3250441966),this.a=this.FF(this.a,this.b,this.c,this.d,this.x[this.k+4],this.S11,4118548399),this.d=this.FF(this.d,this.a,this.b,this.c,this.x[this.k+5],this.S12,1200080426),this.c=this.FF(this.c,this.d,this.a,this.b,this.x[this.k+6],this.S13,2821735955),this.b=this.FF(this.b,this.c,this.d,this.a,this.x[this.k+7],this.S14,4249261313),this.a=this.FF(this.a,this.b,this.c,this.d,this.x[this.k+8],this.S11,1770035416),this.d=this.FF(this.d,this.a,this.b,this.c,this.x[this.k+9],this.S12,2336552879),this.c=this.FF(this.c,this.d,this.a,this.b,this.x[this.k+10],this.S13,4294925233),this.b=this.FF(this.b,this.c,this.d,this.a,this.x[this.k+11],this.S14,2304563134),this.a=this.FF(this.a,this.b,this.c,this.d,this.x[this.k+12],this.S11,1804603682),this.d=this.FF(this.d,this.a,this.b,this.c,this.x[this.k+13],this.S12,4254626195),this.c=this.FF(this.c,this.d,this.a,this.b,this.x[this.k+14],this.S13,2792965006),this.b=this.FF(this.b,this.c,this.d,this.a,this.x[this.k+15],this.S14,1236535329),this.a=this.GG(this.a,this.b,this.c,this.d,this.x[this.k+1],this.S21,4129170786),this.d=this.GG(this.d,this.a,this.b,this.c,this.x[this.k+6],this.S22,3225465664),this.c=this.GG(this.c,this.d,this.a,this.b,this.x[this.k+11],this.S23,643717713),this.b=this.GG(this.b,this.c,this.d,this.a,this.x[this.k],this.S24,3921069994),this.a=this.GG(this.a,this.b,this.c,this.d,this.x[this.k+5],this.S21,3593408605),this.d=this.GG(this.d,this.a,this.b,this.c,this.x[this.k+10],this.S22,38016083),this.c=this.GG(this.c,this.d,this.a,this.b,this.x[this.k+15],this.S23,3634488961),this.b=this.GG(this.b,this.c,this.d,this.a,this.x[this.k+4],this.S24,3889429448),this.a=this.GG(this.a,this.b,this.c,this.d,this.x[this.k+9],this.S21,568446438),this.d=this.GG(this.d,this.a,this.b,this.c,this.x[this.k+14],this.S22,3275163606),this.c=this.GG(this.c,this.d,this.a,this.b,this.x[this.k+3],this.S23,4107603335),this.b=this.GG(this.b,this.c,this.d,this.a,this.x[this.k+8],this.S24,1163531501),this.a=this.GG(this.a,this.b,this.c,this.d,this.x[this.k+13],this.S21,2850285829),this.d=this.GG(this.d,this.a,this.b,this.c,this.x[this.k+2],this.S22,4243563512),this.c=this.GG(this.c,this.d,this.a,this.b,this.x[this.k+7],this.S23,1735328473),this.b=this.GG(this.b,this.c,this.d,this.a,this.x[this.k+12],this.S24,2368359562),this.a=this.HH(this.a,this.b,this.c,this.d,this.x[this.k+5],this.S31,4294588738),this.d=this.HH(this.d,this.a,this.b,this.c,this.x[this.k+8],this.S32,2272392833),this.c=this.HH(this.c,this.d,this.a,this.b,this.x[this.k+11],this.S33,1839030562),this.b=this.HH(this.b,this.c,this.d,this.a,this.x[this.k+14],this.S34,4259657740),this.a=this.HH(this.a,this.b,this.c,this.d,this.x[this.k+1],this.S31,2763975236),this.d=this.HH(this.d,this.a,this.b,this.c,this.x[this.k+4],this.S32,1272893353),this.c=this.HH(this.c,this.d,this.a,this.b,this.x[this.k+7],this.S33,4139469664),this.b=this.HH(this.b,this.c,this.d,this.a,this.x[this.k+10],this.S34,3200236656),this.a=this.HH(this.a,this.b,this.c,this.d,this.x[this.k+13],this.S31,681279174),this.d=this.HH(this.d,this.a,this.b,this.c,this.x[this.k],this.S32,3936430074),this.c=this.HH(this.c,this.d,this.a,this.b,this.x[this.k+3],this.S33,3572445317),this.b=this.HH(this.b,this.c,this.d,this.a,this.x[this.k+6],this.S34,76029189),this.a=this.HH(this.a,this.b,this.c,this.d,this.x[this.k+9],this.S31,3654602809),this.d=this.HH(this.d,this.a,this.b,this.c,this.x[this.k+12],this.S32,3873151461),this.c=this.HH(this.c,this.d,this.a,this.b,this.x[this.k+15],this.S33,530742520),this.b=this.HH(this.b,this.c,this.d,this.a,this.x[this.k+2],this.S34,3299628645),this.a=this.II(this.a,this.b,this.c,this.d,this.x[this.k],this.S41,4096336452),this.d=this.II(this.d,this.a,this.b,this.c,this.x[this.k+7],this.S42,1126891415),this.c=this.II(this.c,this.d,this.a,this.b,this.x[this.k+14],this.S43,2878612391),this.b=this.II(this.b,this.c,this.d,this.a,this.x[this.k+5],this.S44,4237533241),this.a=this.II(this.a,this.b,this.c,this.d,this.x[this.k+12],this.S41,1700485571),this.d=this.II(this.d,this.a,this.b,this.c,this.x[this.k+3],this.S42,2399980690),this.c=this.II(this.c,this.d,this.a,this.b,this.x[this.k+10],this.S43,4293915773),this.b=this.II(this.b,this.c,this.d,this.a,this.x[this.k+1],this.S44,2240044497),this.a=this.II(this.a,this.b,this.c,this.d,this.x[this.k+8],this.S41,1873313359),this.d=this.II(this.d,this.a,this.b,this.c,this.x[this.k+15],this.S42,4264355552),this.c=this.II(this.c,this.d,this.a,this.b,this.x[this.k+6],this.S43,2734768916),this.b=this.II(this.b,this.c,this.d,this.a,this.x[this.k+13],this.S44,1309151649),this.a=this.II(this.a,this.b,this.c,this.d,this.x[this.k+4],this.S41,4149444226),this.d=this.II(this.d,this.a,this.b,this.c,this.x[this.k+11],this.S42,3174756917),this.c=this.II(this.c,this.d,this.a,this.b,this.x[this.k+2],this.S43,718787259),this.b=this.II(this.b,this.c,this.d,this.a,this.x[this.k+9],this.S44,3951481745),this.a=this.AddUnsigned(this.a,this.AA),this.b=this.AddUnsigned(this.b,this.BB),this.c=this.AddUnsigned(this.c,this.CC),this.d=this.AddUnsigned(this.d,this.DD);return(this.WordToHex(this.a)+this.WordToHex(this.b)+this.WordToHex(this.c)+this.WordToHex(this.d)).toLowerCase()},t.x=Array(),t.S11=7,t.S12=12,t.S13=17,t.S14=22,t.S21=5,t.S22=9,t.S23=14,t.S24=20,t.S31=4,t.S32=11,t.S33=16,t.S34=23,t.S41=6,t.S42=10,t.S43=15,t.S44=21,t.RotateLeft=function(t,i){return t<<i|t>>>32-i},t.F=function(t,i,s){return t&i|~t&s},t.G=function(t,i,s){return t&s|i&~s},t.H=function(t,i,s){return t^i^s},t.I=function(t,i,s){return i^(t|~s)},t}(),T="production";function U(){var t=getCurrentPages()||"";return t[t.length-1]||""}function O(t){var i="/";try{var s=U();if(!s)return s;var e,n=s.route,r=s.options;for(var h in e=s.options,i=n+"?",r){if("share"!==t||"txsrShareInfoSdk"!==h)if(x(h))if(e[h])i+=h+"="+r[h]+"&"}i=i.substring(0,i.length-1)}catch(t){console.error("getCurrentPageUrlWithArgs error",t)}return i}function R(t){try{var i=U();if(!i)return i;i.options;return i.options[t]||""}catch(t){console.error("getCurrentPageKey error",t)}return"/"}function F(){var t=U();try{var i=__wxConfig.global.window.navigationBarTitleText;return(t?(__wxConfig.page[t.route+".html"].window||{}).navigationBarTitleText:"")||i||"\u672a\u77e5"}catch(t){}return"\u672a\u77e5"}function H(){return"devtools"===function(){try{return __wxConfig.platform}catch(t){console.error("getEnv failed: ",t)}return""}()}function G(t,i,e){try{var n=t[0],r=void 0===n?{}:n;if(r)switch(r.type){case"tap":case"change":case"longpress":case"confirm":var h=(r.currentTarget||{}).dataset,o=void 0===h?{}:h,a=(this||{}).is;i("element",s({is_sdk_auto_track:!0,is:void 0===a?"":a,type:r.type,id:"#"+e},o))}}catch(t){console.error("elementEventTrack error",t)}}function P(){var t,i=""+T,s=(U()||{}).route||"";try{t=wx.getStorageSync(m.SDK+"_"+i)}catch(t){console.error("CacheManager.get error",t)}var e=t.USER_INFO||{},n=e.local_id,r=e.txsr_from_share_info,h=void 0===r?{}:r,o=h.mi,a=void 0===o?"":o,c=h.d,u=void 0===c?1:c,d=C.init(n+s),p=""!==a?d===a?u:u+1:u;return JSON.stringify({mi:C.init(n+s),d:p})}var D=function(){},M={},j={},E=function(){return(new Date).getTime()};var N=function(t,i,s,e){return function(n){return function(t,i,s,e,n){if(w(t,"onLoad",(function(t,i){t(),this.lauchTime=E()})),w(t,"onShow",(function(t){var e=this,n=function(){e.showTime=E();var t=R.call(e,"room_id");t&&s({room_id:t}),i("browse_wxapp_page",{is_sdk_auto_track:!0,refer_page:j.route,is_newly_open:!M[e.route]}),M[e.route]=!0,j=e};t().then(n).catch(n)}),!0),w(t,"onHide",(function(t){t();var s=this.showTime?E()-this.showTime:0;i("leave_wxapp_page",{is_sdk_auto_track:!0,stay_time:s=s>144e5?0:s})})),w(t,"onUnload",(function(t){t();var s=this.lauchTime?E()-this.lauchTime:0;i("leave_wxapp_page",{is_sdk_auto_track:!0,stay_time:s=s>144e5?0:s})})),w(t,"onPullDownRefresh",(function(t){t(),i("page_pull_down_refresh",{is_sdk_auto_track:!0})})),w(t,"onReachBottom",(function(t){t(),i("page_reach_bottom",{is_sdk_auto_track:!0})})),"function"==typeof t.onShareAppMessage){var r=t.onShareAppMessage||D;t.onShareAppMessage=function(t){void 0===t&&(t={});var s=r.call(this,t)||{};try{var e=s.path||O.call(this,"share");-1===e.indexOf("?")?e+="?":"&"!==e.slice(-1)&&(e+="&");var h=void 0,o=void 0;n&&(h=P(),o=JSON.parse(h),e=e+"txsrShareInfoSdk="+encodeURIComponent(h)),i("page_share_app_message",{is_sdk_auto_track:!0,from_type:t.from||"\u672a\u77e5",share_path:e,share_title:s.title,share_image_url:s.imageUrl,txsr_share_info_sdk:o}),s.path=e}catch(t){console.error("onShareAppMessage error",t)}return s}}return e&&Object.entries(t).filter((function(t){var i=t[0];t[1];return!["onLoad","onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onPageScroll","onShareAppMessage","onResize","onTabItemTap"].includes(i)})).forEach((function(s){var e=s[0];"function"==typeof s[1]&&w(t,e,(function(t){for(var s=arguments,n=[],r=1;r<arguments.length;r++)n[r-1]=s[r];return G.call(this,n,i,e),t()}))})),t}(n,t,i,s,e)}},q=function(){},z={},K={},W=function(){return(new Date).getTime()};var B=function(t,i,s,e){return function(n){return function(t,i,s,e,n){try{if(t.methods=t.methods||{},w(t.methods,"onLoad",(function(t,i){t(),this.lauchTime=W()})),w(t.methods,"onShow",(function(t){var e=this,n=function(){e.showTime=W();var t=R.call(e,"room_id");t&&s({room_id:t}),i("browse_wxapp_page",{is_sdk_auto_track:!0,refer_page:K.route,is_newly_open:!z[e.route]}),z[e.route]=!0,K=e};t().then(n).catch(n)}),!0),w(t.methods,"onUnload",(function(t){t();var s=this.lauchTime?W()-this.lauchTime:0;i("leave_wxapp_page",{is_sdk_auto_track:!0,stay_time:s=s>144e5?0:s})})),w(t.methods,"onPullDownRefresh",(function(t){t(),i("page_pull_down_refresh",{is_sdk_auto_track:!0})})),w(t.methods,"onReachBottom",(function(t){t(),i("page_reach_bottom",{is_sdk_auto_track:!0})})),w(t.methods,"onHide",(function(t){t();var s=this.showTime?W()-this.showTime:0;i("leave_wxapp_page",{is_sdk_auto_track:!0,stay_time:s=s>144e5?0:s})})),"function"==typeof t.methods.onShareAppMessage){var r=t.methods.onShareAppMessage||q;t.methods.onShareAppMessage=function(t){void 0===t&&(t={});var s=r.call(this,t)||{};try{var e=s.path||O.call(this,"share");-1===e.indexOf("?")?e+="?":"&"!==e.slice(-1)&&(e+="&");var h=void 0,o=void 0;n&&(h=P(),o=JSON.parse(h),e=e+"txsrShareInfoSdk="+encodeURIComponent(h)),i("page_share_app_message",{is_sdk_auto_track:!0,from_type:t.from||"\u672a\u77e5",share_path:e,share_title:s.title,share_image_url:s.imageUrl,txsr_share_info_sdk:o}),s.path=e}catch(t){console.error("onShareAppMessage error",t)}return s}}t.methods&&e&&Object.entries(t.methods).filter((function(t){var i=t[0];t[1];return!["onLoad","onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onPageScroll","onShareAppMessage","onResize","onTabItemTap","observer"].includes(i)})).forEach((function(s){var e=s[0];"function"==typeof s[1]&&w(t.methods,e,(function(t){for(var s=arguments,n=[],r=1;r<arguments.length;r++)n[r-1]=s[r];return G.call(this,n,i,e),t()}))}))}catch(t){console.error("componentProxy error",t)}return t}(n,t,i,s,e)}},L={},J=function(t){return t},Q=function(t){function e(){var i=t.call(this)||this;return i.name="mp",i.component=J,i.page=J,i.proxySetNavigation=function(){try{var t=wx.setNavigationBarTitle;Object.defineProperty(wx,"setNavigationBarTitle",{get:function(){return function(i){void 0===i&&(i={});try{var s=U();__wxConfig.page=__wxConfig.page||{};var e=__wxConfig.page[s.route+".html"];e&&((e.window||{}).navigationBarTitleText=i.title)}catch(t){}t.call(this,i)}}})}catch(t){console.warn("proxySetNavigation failed",t)}},i.request=function(t,s){var e=function(t){return void 0===t&&(t={}),0===t.code};return"function"==typeof i.option.onUploaded&&(e=i.option.onUploaded),new Promise((function(i,n){wx.request({url:s.url,method:s.method||"POST",data:t,success:function(t){void 0===t&&(t={});var s=t.data,n=void 0===s?{}:s,r=e(n);i({success:void 0===r||r,data:n.data||n,msg:n.errMsg})},fail:function(t){n({success:!1,data:void 0,msg:t.errMsg})}})}))},i.defaultOptions={autoStart:!0,debug:!1,usePlugin:!1,proxyPage:!1,proxyComponent:!1,autoTrack:!1,trackApp:!0,openSdkShareDepth:!1},i.proxySetNavigation(),i}return i(e,t),e.prototype.getCacheManager=function(){var t=""+this.env,i=function(i){return i+"_"+t};return{get:function(t){var s;try{s=wx.getStorageSync(i(t))}catch(t){return console.error("CacheManager.get error",t),s}return s},set:function(t,s){try{wx.setStorageSync(i(t),s)}catch(t){return console.error("CacheManager.set error",t),!1}return!0}}},e.prototype.proxyInitialize=function(){var t=this,i=Page,s=Component,e=this.option.autoTrack,n=this.option.openSdkShareDepth;return this.page=N(this.track.bind(this),this.setChan.bind(this),e,n),this.component=B(this.track.bind(this),this.setChan.bind(this),e,n),!this.option.usePlugin&&this.option.proxyPage&&(Page=function(s){i(t.page(s))}),!this.option.usePlugin&&this.option.proxyComponent&&(Component=function(i){return s(t.component(i))}),this.trackApp(),!0},e.prototype.trackApp=function(){var t=this,i=!1;wx.onAppShow((function(e){void 0===e&&(e={});var n=e,r=n.query,h=void 0===r?{}:r,o=n.path,a=t.option.openSdkShareDepth,c=function(t){void 0===t&&(t={});var i={};if(t.scene){try{var e=decodeURIComponent(t.scene);(e=e.replace("?","").trim()).split("&").map((function(t){if(t){var s=t.split("="),e=s[0],n=s[1];x(e)&&(i[e]=void 0===n||n)}}))}catch(t){console.error(t)}t=s(s({},t),i)}return t}(h||{}),u=c.txsrShareInfoSdk||"{}";if(c&&"{}"!==JSON.stringify(c)){var d="?";Object.entries(c).forEach((function(t,i){var s=t[0],e=t[1];d+=(0===i?"":"&")+s+"="+e})),o+=d}if(t.setChan(s(s({},c),{chan_wxapp_scene:e.scene,chan_refer_app_id:(e.referrerInfo||{}).appId})),c.chan_id&&t.setChan({chan_id:c.chan_id}),!i){if(i=!0,a&&"{}"!==u)try{t.setUser({txsr_from_share_info:JSON.parse(decodeURIComponent(u))})}catch(t){}t.option.trackApp&&t.track("app_launch",{is_sdk_auto_track:!0,page:o})}t.option.trackApp&&t.track("app_show",{is_sdk_auto_track:!0,page:o})})),wx.onAppHide((function(){t.option.trackApp&&t.track("exit_wxapp",{is_sdk_auto_track:!0})}))},e.prototype.errorHandle=function(t){try{var i=this.getServerUrl();this.request({type:"sdk api exec error",props:{sr_sdk_version:this.version,system_info:this.getSystemInfo(),message:t,stack:t}},{url:i,method:"POST"})}catch(t){console.log("errorHandle error",t)}},e.prototype.getSystemInfo=function(){try{return wx.getSystemInfoSync()}catch(t){return{}}},e.prototype.getPageInfo=function(){var t=O(),i=U()||{},s=F,e=(i.data||{}).title||i.title;try{void 0===e&&t&&!L[t]&&(L[t]=!0,console.warn("\u9875\u9762["+t+"]\u6ca1\u6709\u5b9e\u73b0 title \u5c5e\u6027\uff0c\u4f1a\u5bfc\u81f4\u90e8\u5206\u673a\u578b\u4e0b\u6536\u96c6\u4e0d\u5230\u9875\u9762\u6807\u9898!")),"string"==typeof e&&(s=function(){return e}),"function"==typeof e&&(s=e)}catch(t){console.error("curPage.data.title \u6267\u884c\u9519\u8bef",t)}return{page:t,page_title:e||s()}},e.prototype.isDev=function(){return H()},e.create=function(){var t;try{t=new e}catch(i){t=e.prototype,console.error("new sr_sdk failed",i)}return t},e}(A).create();try{var Z=require("./sr-sdk-config");Q.init(Z)}catch(t){}return Q}));
